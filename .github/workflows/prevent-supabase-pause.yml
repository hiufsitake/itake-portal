name: Prevent Supabase Pause

on:
  schedule:
    # Runs at 08:00 AM Malaysia Time (00:00 UTC) EVERY DAY
    - cron: '0 0 * * *'
  workflow_dispatch: # Allows manual trigger for testing

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase Database
        env:
          # Pulls the key from GitHub Secrets
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          # YOUR PROJECT ID
          PROJECT_ID: lzaqhdfntyccyfevcocd
        run: |
          echo "Pinging Supabase Project: $PROJECT_ID..."
          
          # We use the /rest/v1/ endpoint which counts as activity
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET "https://$PROJECT_ID.supabase.co/rest/v1/" \
            -H "apikey: $SUPABASE_KEY" \
            -H "Authorization: Bearer $SUPABASE_KEY")
            
          if [ "$response" -eq 200 ]; then
            echo "Success! Supabase responded with 200 OK."
          else
            echo "Failed! Supabase responded with code: $response"
            exit 1
          fi
